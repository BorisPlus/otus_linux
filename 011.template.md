#  Управление процессами 

__Домашнее задание__

Задания на выбор:
* написать свою реализацию ps ax используя анализ /proc
    * Результат ДЗ - рабочий скрипт который можно запустить
* написать свою реализацию lsof
    * Результат ДЗ - рабочий скрипт который можно запустить
* дописать обработчики сигналов в прилагаемом скрипте, оттестировать, приложить сам скрипт, инструкции по использованию
    * Результат ДЗ - рабочий скрипт который можно запустить + инструкция по использованию и лог консоли
* реализовать 2 конкурирующих процесса по IO. пробовать запустить с разными ionice
    Результат ДЗ - скрипт запускающий 2 процесса с разными ionice, замеряющий время выполнения и лог консоли
* реализовать 2 конкурирующих процесса по CPU. пробовать запустить с разными nice
    * Результат ДЗ - скрипт запускающий 2 процесса с разными nice и замеряющий время выполнения и лог консоли

__Критерии оценки__:

Статус "Принято" ставится при написании любого скрипта. Более одного скрипта - по желанию

## Написать свою реализацию `ps ax` используя анализ `/proc`

[Результат.](https://github.com/BorisPlus/otus_linux/blob/master/011.md#результат)

### Исходные данные

Вывод команды `ps ax` (для примера PID: 26928)

```shell
ps ax -q 26928
26928 tty2     Sl+   08:10 /usr/lib/firefox-esr/firefox-esr -contentproc -childID 35 -isForBrowser -prefsLen 10083 -prefMapSize 220111 -parentBuildID 20210412162915 -appdir /usr/lib/firefox-esr/b
b
```

### Какие параметры `ps ax` где можно взять в `/proc`

#### PID

Столбец `PID` это сама поддиректория:

```shell
/proc/<PID>/
```

#### STAT

Столбец `STAT` это 3 показатель `/proc/27617/stat`, но так как возможны пробельные символы во втором столбце с комментарием, то необходимо сделать манипуляцию `взять 50 показатель с конца`
```shell
cat /proc/27617/stat | rev | awk '{printf $50}' | rev
    S
```

#### TIME

Столбец TIME это суммарное время 14, 15, 16 и 17 показателей `/proc/27617/stat`
```shell

cat /proc/26928/stat
26928 (Web Content) S   2214 968 968 1026 968 4194304 1534472 0 5 0 24516 6236 0 0 20 0 27 0 51674715 3313963008 157533 18446744073709551615 93856325378048 93856325887301 140731301679648 0 0 0 0 16846850 1082131704 0 0 0 17 1 0 0 0 0 0 93856325996936 93856326002020 93856349323264 140731301685153 140731301685342 140731301685342 140731301687255 0
(1)   (2) ^space    (3) (4)                                         14    15   16 17 

cat /proc/26928/stat | rev | awk '{print $36" "$37" "$38" "$39}' | rev
25742 6524 0 0

cat /proc/26928/stat | rev | awk '{print $36" "$37" "$38" "$39}' | rev | awk '{sum=$1+$2+$3+$4}END{print strftime(sum)}'
32272

cat /proc/26928/stat | rev | awk '{print $36" "$37" "$38" "$39}' | rev | awk '{sum=$1+$2+$3+$4}END{print sum/100}' | awk '{("date +%T -d @"$1)| getline $1}1'
  03:10:38
  ^  ^
  |  |
  |  ВРЕМЯ НО 
  |
  C ЧАСАМИ
     
ps ax -q 26928 -o time
    TIME
    00:10:38
    ^  ^
    |  |
    |  ВРЕМЯ НО 
    |
    БЕЗ ЧАСОВ (Вопрос: куда пропали 3 часа)

cat /proc/26928/stat | rev | awk '{print $36" "$37" "$38" "$39}' | rev | awk '{sum=$1+$2+$3+$4}END{print sum/100}' | awk '{("date +%M:%S -d @"$1)| getline $1}1'
    10:38
```

#### COMMAND

Столбец `COMMAND` это содержание
```shell
cat /proc/26928/cmdline 
/usr/lib/firefox-esr/firefox-esr-contentproc-childID35-isForBrowser-prefsLen10083-prefMapSize220111-parentBuildID20210412162915-appdir/usr/lib/firefox-esr/browser2214truetab
```

#### TTY

Тут немного не понятно как декодировать, но подход такой

```shell
man proc
...
    (7) tty_nr  %d
    The controlling terminal of the process.  (The minor device number is contained in the combination of bits 31 to 20 and 7 to 0; the major device number is in bits 15 to 8.)
...

```

Столбец `TTY` это 7 показатель `/proc/26928/stat`, но необходимо придерживаться манипуляцию `взять $46 показатель с конца`:

```shell
cat /proc/26928/stat | rev | awk '{printf $46}' | rev
    1026
    
ps ax -q 26928 -o tty
    TT
    tty2
```

Конвертация (но это не точно ;-) ):

```text
1026 --> (Decimal to Binary) --> 10000000010 

                 (31)           (20)     (15)     (8)(7)      (0)
   1     0     0     0     0     0     0     0     0     1     0
0001  0000  0000  0000  0000  0000  0000  0000  0000  0001  0000

Minor device number = combination of bits 31 to 20 and 7 to 0.

                 (31)           (20)     (15)     (8)(7)      (0)
                     0     0     0     0     0     0     1     0
                  0000  0000  0000                    0001  0000

Minor 00000010 --> (Binary to Decimal) --> 2 ------------>.
                                                          |
                                                          |
Major device number is in bits 15 to 8.                   |
                                         (15)     (8)     |--> ("Major" concat "Minor") --> 02 => tty2
                                             0     0      |
                                          0000  0000      |
                                                          |
Major 00 --> (Binary to Decimal) --> 0 ------------------>' 


("Major" concat "Minor") --> 02 => tty2

```

### Результат

__Внимание__: в конце осознал, что не сделал сортировку по PID. 

Сделать обход директории `proc` и напечатать все выше перечисленное:

Реализация [template]:[разработанного скрипта](011/psax.sh)

Результат [template]:[вывода в консоль](011/psax.sh.log)

Для сверки со штатным [template]:[`ps ax`](011/ps ax.log)