
PLAY [Check openvpn server] ****************************************************

TASK [Gathering Facts] *********************************************************
ok: [server]

TASK [../roles/check_openvpn_server : Check openvpn server] ********************
changed: [server] => (item=systemctl status openvpn@server.service)
changed: [server] => (item=sudo cat /var/log/openvpn/openvpn.log)
changed: [server] => (item=sudo cat /var/log/openvpn/openvpn-status.log)
changed: [server] => (item=/sbin/ip add show tun0)

TASK [../roles/check_openvpn_server : Store check to files] ********************
changed: [server -> localhost] => (item={'changed': True, 'end': '2021-09-18 21:10:56.024903', 'stdout': '● openvpn@server.service - OpenVPN Robust And Highly Flexible Tunneling Application On server\n   Loaded: loaded (/usr/lib/systemd/system/openvpn@.service; disabled; vendor preset: disabled)\n   Active: active (running) since Сб 2021-09-18 20:30:45 UTC; 40min ago\n Main PID: 5599 (openvpn)\n   Status: "Initialization Sequence Completed"\n   CGroup: /system.slice/system-openvpn.slice/openvpn@server.service\n           └─5599 /usr/sbin/openvpn --cd /etc/openvpn/ --config server.conf', 'cmd': 'systemctl status openvpn@server.service', 'rc': 0, 'start': '2021-09-18 21:10:55.998710', 'stderr': '', 'delta': '0:00:00.026193', 'invocation': {'module_args': {'creates': None, 'executable': None, '_uses_shell': True, 'strip_empty_ends': True, '_raw_params': 'systemctl status openvpn@server.service', 'removes': None, 'argv': None, 'warn': False, 'chdir': None, 'stdin_add_newline': True, 'stdin': None}}, 'stdout_lines': ['● openvpn@server.service - OpenVPN Robust And Highly Flexible Tunneling Application On server', '   Loaded: loaded (/usr/lib/systemd/system/openvpn@.service; disabled; vendor preset: disabled)', '   Active: active (running) since Сб 2021-09-18 20:30:45 UTC; 40min ago', ' Main PID: 5599 (openvpn)', '   Status: "Initialization Sequence Completed"', '   CGroup: /system.slice/system-openvpn.slice/openvpn@server.service', '           └─5599 /usr/sbin/openvpn --cd /etc/openvpn/ --config server.conf'], 'stderr_lines': [], 'failed': False, 'item': 'systemctl status openvpn@server.service', 'ansible_loop_var': 'item'})
changed: [server -> localhost] => (item={'changed': True, 'end': '2021-09-18 21:10:56.605750', 'stdout': "Sat Sep 18 20:30:45 2021 WARNING: file '/etc/openvpn/keys/private/server.key' is group or others accessible\nSat Sep 18 20:30:45 2021 WARNING: file '/etc/openvpn/keys/tc.key' is group or others accessible\nSat Sep 18 20:30:45 2021 OpenVPN 2.4.11 x86_64-redhat-linux-gnu [Fedora EPEL patched] [SSL (OpenSSL)] [LZO] [LZ4] [EPOLL] [PKCS11] [MH/PKTINFO] [AEAD] built on Apr 21 2021\nSat Sep 18 20:30:45 2021 library versions: OpenSSL 1.0.2k-fips  26 Jan 2017, LZO 2.06\nSat Sep 18 20:30:45 2021 Diffie-Hellman initialized with 2048 bit key\nSat Sep 18 20:30:45 2021 Outgoing Control Channel Authentication: Using 160 bit message hash 'SHA1' for HMAC authentication\nSat Sep 18 20:30:45 2021 Incoming Control Channel Authentication: Using 160 bit message hash 'SHA1' for HMAC authentication\nSat Sep 18 20:30:45 2021 ROUTE_GATEWAY 10.0.2.2/255.255.255.0 IFACE=eth0 HWADDR=52:54:00:4d:77:d3\nSat Sep 18 20:30:45 2021 TUN/TAP device tun0 opened\nSat Sep 18 20:30:45 2021 TUN/TAP TX queue length set to 100\nSat Sep 18 20:30:45 2021 /sbin/ip link set dev tun0 up mtu 1500\nSat Sep 18 20:30:45 2021 /sbin/ip addr add dev tun0 local 172.16.10.1 peer 172.16.10.2\nSat Sep 18 20:30:45 2021 /sbin/ip route add 172.16.10.0/24 via 172.16.10.2\nSat Sep 18 20:30:45 2021 Could not determine IPv4/IPv6 protocol. Using AF_INET\nSat Sep 18 20:30:45 2021 Socket Buffers: R=[212992->212992] S=[212992->212992]\nSat Sep 18 20:30:45 2021 UDPv4 link local (bound): [AF_INET]192.168.31.1:1194\nSat Sep 18 20:30:45 2021 UDPv4 link remote: [AF_UNSPEC]\nSat Sep 18 20:30:45 2021 GID set to nobody\nSat Sep 18 20:30:45 2021 UID set to nobody\nSat Sep 18 20:30:45 2021 MULTI: multi_init called, r=256 v=256\nSat Sep 18 20:30:45 2021 IFCONFIG POOL: base=172.16.10.4 size=62, ipv6=0\nSat Sep 18 20:30:45 2021 IFCONFIG POOL LIST\nSat Sep 18 20:30:45 2021 Initialization Sequence Completed\nSat Sep 18 20:48:20 2021 192.168.31.2:39284 TLS: Initial packet from [AF_INET]192.168.31.2:39284, sid=f4d1c784 9c516433\nSat Sep 18 20:48:20 2021 192.168.31.2:39284 VERIFY OK: depth=1, CN=Easy-RSA CA\nSat Sep 18 20:48:20 2021 192.168.31.2:39284 VERIFY OK: depth=0, CN=yes\nSat Sep 18 20:48:20 2021 192.168.31.2:39284 peer info: IV_VER=2.4.11\nSat Sep 18 20:48:20 2021 192.168.31.2:39284 peer info: IV_PLAT=linux\nSat Sep 18 20:48:20 2021 192.168.31.2:39284 peer info: IV_PROTO=2\nSat Sep 18 20:48:20 2021 192.168.31.2:39284 peer info: IV_NCP=2\nSat Sep 18 20:48:20 2021 192.168.31.2:39284 peer info: IV_CIPHERS=AES-256-GCM:AES-128-GCM:BF-CBC\nSat Sep 18 20:48:20 2021 192.168.31.2:39284 peer info: IV_LZ4=1\nSat Sep 18 20:48:20 2021 192.168.31.2:39284 peer info: IV_LZ4v2=1\nSat Sep 18 20:48:20 2021 192.168.31.2:39284 peer info: IV_LZO=1\nSat Sep 18 20:48:20 2021 192.168.31.2:39284 peer info: IV_COMP_STUB=1\nSat Sep 18 20:48:20 2021 192.168.31.2:39284 peer info: IV_COMP_STUBv2=1\nSat Sep 18 20:48:20 2021 192.168.31.2:39284 peer info: IV_TCPNL=1\nSat Sep 18 20:48:20 2021 192.168.31.2:39284 Control Channel: TLSv1.2, cipher TLSv1/SSLv3 ECDHE-RSA-AES256-GCM-SHA384, 2048 bit RSA\nSat Sep 18 20:48:20 2021 192.168.31.2:39284 [yes] Peer Connection Initiated with [AF_INET]192.168.31.2:39284\nSat Sep 18 20:48:20 2021 yes/192.168.31.2:39284 MULTI_sva: pool returned IPv4=172.16.10.6, IPv6=(Not enabled)\nSat Sep 18 20:48:20 2021 yes/192.168.31.2:39284 MULTI: Learn: 172.16.10.6 -> yes/192.168.31.2:39284\nSat Sep 18 20:48:20 2021 yes/192.168.31.2:39284 MULTI: primary virtual IP for yes/192.168.31.2:39284: 172.16.10.6\nSat Sep 18 20:48:21 2021 yes/192.168.31.2:39284 PUSH: Received control message: 'PUSH_REQUEST'\nSat Sep 18 20:48:21 2021 yes/192.168.31.2:39284 SENT CONTROL [yes]: 'PUSH_REPLY,route 172.16.10.0 255.255.255.0,topology net30,ping 10,ping-restart 120,ifconfig 172.16.10.6 172.16.10.5,peer-id 0,cipher AES-256-GCM' (status=1)\nSat Sep 18 20:48:21 2021 yes/192.168.31.2:39284 Data Channel: using negotiated cipher 'AES-256-GCM'\nSat Sep 18 20:48:21 2021 yes/192.168.31.2:39284 Outgoing Data Channel: Cipher 'AES-256-GCM' initialized with 256 bit key\nSat Sep 18 20:48:21 2021 yes/192.168.31.2:39284 Incoming Data Channel: Cipher 'AES-256-GCM' initialized with 256 bit key", 'cmd': 'sudo cat /var/log/openvpn/openvpn.log', 'rc': 0, 'start': '2021-09-18 21:10:56.551650', 'stderr': '', 'delta': '0:00:00.054100', 'invocation': {'module_args': {'creates': None, 'executable': None, '_uses_shell': True, 'strip_empty_ends': True, '_raw_params': 'sudo cat /var/log/openvpn/openvpn.log', 'removes': None, 'argv': None, 'warn': False, 'chdir': None, 'stdin_add_newline': True, 'stdin': None}}, 'stdout_lines': ["Sat Sep 18 20:30:45 2021 WARNING: file '/etc/openvpn/keys/private/server.key' is group or others accessible", "Sat Sep 18 20:30:45 2021 WARNING: file '/etc/openvpn/keys/tc.key' is group or others accessible", 'Sat Sep 18 20:30:45 2021 OpenVPN 2.4.11 x86_64-redhat-linux-gnu [Fedora EPEL patched] [SSL (OpenSSL)] [LZO] [LZ4] [EPOLL] [PKCS11] [MH/PKTINFO] [AEAD] built on Apr 21 2021', 'Sat Sep 18 20:30:45 2021 library versions: OpenSSL 1.0.2k-fips  26 Jan 2017, LZO 2.06', 'Sat Sep 18 20:30:45 2021 Diffie-Hellman initialized with 2048 bit key', "Sat Sep 18 20:30:45 2021 Outgoing Control Channel Authentication: Using 160 bit message hash 'SHA1' for HMAC authentication", "Sat Sep 18 20:30:45 2021 Incoming Control Channel Authentication: Using 160 bit message hash 'SHA1' for HMAC authentication", 'Sat Sep 18 20:30:45 2021 ROUTE_GATEWAY 10.0.2.2/255.255.255.0 IFACE=eth0 HWADDR=52:54:00:4d:77:d3', 'Sat Sep 18 20:30:45 2021 TUN/TAP device tun0 opened', 'Sat Sep 18 20:30:45 2021 TUN/TAP TX queue length set to 100', 'Sat Sep 18 20:30:45 2021 /sbin/ip link set dev tun0 up mtu 1500', 'Sat Sep 18 20:30:45 2021 /sbin/ip addr add dev tun0 local 172.16.10.1 peer 172.16.10.2', 'Sat Sep 18 20:30:45 2021 /sbin/ip route add 172.16.10.0/24 via 172.16.10.2', 'Sat Sep 18 20:30:45 2021 Could not determine IPv4/IPv6 protocol. Using AF_INET', 'Sat Sep 18 20:30:45 2021 Socket Buffers: R=[212992->212992] S=[212992->212992]', 'Sat Sep 18 20:30:45 2021 UDPv4 link local (bound): [AF_INET]192.168.31.1:1194', 'Sat Sep 18 20:30:45 2021 UDPv4 link remote: [AF_UNSPEC]', 'Sat Sep 18 20:30:45 2021 GID set to nobody', 'Sat Sep 18 20:30:45 2021 UID set to nobody', 'Sat Sep 18 20:30:45 2021 MULTI: multi_init called, r=256 v=256', 'Sat Sep 18 20:30:45 2021 IFCONFIG POOL: base=172.16.10.4 size=62, ipv6=0', 'Sat Sep 18 20:30:45 2021 IFCONFIG POOL LIST', 'Sat Sep 18 20:30:45 2021 Initialization Sequence Completed', 'Sat Sep 18 20:48:20 2021 192.168.31.2:39284 TLS: Initial packet from [AF_INET]192.168.31.2:39284, sid=f4d1c784 9c516433', 'Sat Sep 18 20:48:20 2021 192.168.31.2:39284 VERIFY OK: depth=1, CN=Easy-RSA CA', 'Sat Sep 18 20:48:20 2021 192.168.31.2:39284 VERIFY OK: depth=0, CN=yes', 'Sat Sep 18 20:48:20 2021 192.168.31.2:39284 peer info: IV_VER=2.4.11', 'Sat Sep 18 20:48:20 2021 192.168.31.2:39284 peer info: IV_PLAT=linux', 'Sat Sep 18 20:48:20 2021 192.168.31.2:39284 peer info: IV_PROTO=2', 'Sat Sep 18 20:48:20 2021 192.168.31.2:39284 peer info: IV_NCP=2', 'Sat Sep 18 20:48:20 2021 192.168.31.2:39284 peer info: IV_CIPHERS=AES-256-GCM:AES-128-GCM:BF-CBC', 'Sat Sep 18 20:48:20 2021 192.168.31.2:39284 peer info: IV_LZ4=1', 'Sat Sep 18 20:48:20 2021 192.168.31.2:39284 peer info: IV_LZ4v2=1', 'Sat Sep 18 20:48:20 2021 192.168.31.2:39284 peer info: IV_LZO=1', 'Sat Sep 18 20:48:20 2021 192.168.31.2:39284 peer info: IV_COMP_STUB=1', 'Sat Sep 18 20:48:20 2021 192.168.31.2:39284 peer info: IV_COMP_STUBv2=1', 'Sat Sep 18 20:48:20 2021 192.168.31.2:39284 peer info: IV_TCPNL=1', 'Sat Sep 18 20:48:20 2021 192.168.31.2:39284 Control Channel: TLSv1.2, cipher TLSv1/SSLv3 ECDHE-RSA-AES256-GCM-SHA384, 2048 bit RSA', 'Sat Sep 18 20:48:20 2021 192.168.31.2:39284 [yes] Peer Connection Initiated with [AF_INET]192.168.31.2:39284', 'Sat Sep 18 20:48:20 2021 yes/192.168.31.2:39284 MULTI_sva: pool returned IPv4=172.16.10.6, IPv6=(Not enabled)', 'Sat Sep 18 20:48:20 2021 yes/192.168.31.2:39284 MULTI: Learn: 172.16.10.6 -> yes/192.168.31.2:39284', 'Sat Sep 18 20:48:20 2021 yes/192.168.31.2:39284 MULTI: primary virtual IP for yes/192.168.31.2:39284: 172.16.10.6', "Sat Sep 18 20:48:21 2021 yes/192.168.31.2:39284 PUSH: Received control message: 'PUSH_REQUEST'", "Sat Sep 18 20:48:21 2021 yes/192.168.31.2:39284 SENT CONTROL [yes]: 'PUSH_REPLY,route 172.16.10.0 255.255.255.0,topology net30,ping 10,ping-restart 120,ifconfig 172.16.10.6 172.16.10.5,peer-id 0,cipher AES-256-GCM' (status=1)", "Sat Sep 18 20:48:21 2021 yes/192.168.31.2:39284 Data Channel: using negotiated cipher 'AES-256-GCM'", "Sat Sep 18 20:48:21 2021 yes/192.168.31.2:39284 Outgoing Data Channel: Cipher 'AES-256-GCM' initialized with 256 bit key", "Sat Sep 18 20:48:21 2021 yes/192.168.31.2:39284 Incoming Data Channel: Cipher 'AES-256-GCM' initialized with 256 bit key"], 'stderr_lines': [], 'failed': False, 'item': 'sudo cat /var/log/openvpn/openvpn.log', 'ansible_loop_var': 'item'})
changed: [server -> localhost] => (item={'changed': True, 'end': '2021-09-18 21:10:57.176493', 'stdout': 'OpenVPN CLIENT LIST\nUpdated,Sat Sep 18 21:10:07 2021\nCommon Name,Real Address,Bytes Received,Bytes Sent,Connected Since\nyes,192.168.31.2:39284,8680,8352,Sat Sep 18 20:48:20 2021\nROUTING TABLE\nVirtual Address,Common Name,Real Address,Last Ref\n172.16.10.6,yes,192.168.31.2:39284,Sat Sep 18 20:48:20 2021\nGLOBAL STATS\nMax bcast/mcast queue length,0\nEND', 'cmd': 'sudo cat /var/log/openvpn/openvpn-status.log', 'rc': 0, 'start': '2021-09-18 21:10:57.132821', 'stderr': '', 'delta': '0:00:00.043672', 'invocation': {'module_args': {'creates': None, 'executable': None, '_uses_shell': True, 'strip_empty_ends': True, '_raw_params': 'sudo cat /var/log/openvpn/openvpn-status.log', 'removes': None, 'argv': None, 'warn': False, 'chdir': None, 'stdin_add_newline': True, 'stdin': None}}, 'stdout_lines': ['OpenVPN CLIENT LIST', 'Updated,Sat Sep 18 21:10:07 2021', 'Common Name,Real Address,Bytes Received,Bytes Sent,Connected Since', 'yes,192.168.31.2:39284,8680,8352,Sat Sep 18 20:48:20 2021', 'ROUTING TABLE', 'Virtual Address,Common Name,Real Address,Last Ref', '172.16.10.6,yes,192.168.31.2:39284,Sat Sep 18 20:48:20 2021', 'GLOBAL STATS', 'Max bcast/mcast queue length,0', 'END'], 'stderr_lines': [], 'failed': False, 'item': 'sudo cat /var/log/openvpn/openvpn-status.log', 'ansible_loop_var': 'item'})
changed: [server -> localhost] => (item={'changed': True, 'end': '2021-09-18 21:10:57.728652', 'stdout': '4: tun0: <POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UNKNOWN group default qlen 100\n    link/none \n    inet 172.16.10.1 peer 172.16.10.2/32 scope global tun0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::aade:ff87:a922:259c/64 scope link flags 800 \n       valid_lft forever preferred_lft forever', 'cmd': '/sbin/ip add show tun0', 'rc': 0, 'start': '2021-09-18 21:10:57.717765', 'stderr': '', 'delta': '0:00:00.010887', 'invocation': {'module_args': {'creates': None, 'executable': None, '_uses_shell': True, 'strip_empty_ends': True, '_raw_params': '/sbin/ip add show tun0', 'removes': None, 'argv': None, 'warn': False, 'chdir': None, 'stdin_add_newline': True, 'stdin': None}}, 'stdout_lines': ['4: tun0: <POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UNKNOWN group default qlen 100', '    link/none ', '    inet 172.16.10.1 peer 172.16.10.2/32 scope global tun0', '       valid_lft forever preferred_lft forever', '    inet6 fe80::aade:ff87:a922:259c/64 scope link flags 800 ', '       valid_lft forever preferred_lft forever'], 'stderr_lines': [], 'failed': False, 'item': '/sbin/ip add show tun0', 'ansible_loop_var': 'item'})

PLAY RECAP *********************************************************************
server                     : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

