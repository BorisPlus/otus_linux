#  Сетевые пакеты. LACP 

Начну c того, что для реализации рабочего стенда было перелопачено слишком много материала. Менялись дистрибутивы, менялись ядра, менялись версии операционок, менялись утилиты настройки. Мне было очень дорого время отладки и разработки и я развернул отдельный стенд, для это задачи, просто 2 узла и 2 канала между ними. Если необходимо, то я объединю с общим репозиторием, но смысла не вижу. Математика одна.

* https://centos.name/?page/tipsandtricks/BondingInterfaces
* https://ahelpme.com/linux/centos-8/adding-bonding-interface-to-centos-8-editing-configuration-files-only/
* https://github.com/simonmcc/vagrant-bond/blob/master/shell/convert2bond.sh
* https://help.ubuntu.com/community/UbuntuBonding

В итоге сделано все на боевую на CentOS7. (в 8-ом - мною нелюбимы NetworkManager штатно вшит, он приносит много мороки). 

## Исполнение

Очень важно понимать, что должно быть именно ДВА независимых ФИЗИЧЕСКИХ канала, будто два провайдера. Соответсвенно в [details]:[Vagrantfile](./033_part2/vm/Vagrantfile) это каналы адапторов: 

```shell
cd ../vm/
vagrant destroy -f && vagrant up 
python3 v2a.py -o ../ansible/inventories/hosts
cd ../ansible/
ansible-playbook playbooks/create_bond.yml 
```

[details]:[лог `ansible-playbook playbooks/create_bond.yml`](./033_part2/files/playbooks_create_bond.yml.log)

## Результат

Для inetRouter:

[details --no-link]:[лог `cat /etc/modprobe.conf.`](./033_part2/files/inetRouter - cat _etc_modprobe.conf.txt)
[details --no-link]:[лог `cat /etc/sysconfig/network-scripts/ifcfg-bond0`](./033_part2/files/inetRouter - cat _etc_sysconfig_network-scripts_ifcfg-bond0.txt)
[details --no-link]:[лог `cat /etc/sysconfig/network-scripts/ifcfg-eth1`](./033_part2/files/inetRouter - cat _etc_sysconfig_network-scripts_ifcfg-eth1.txt)
[details --no-link]:[лог `cat /etc/sysconfig/network-scripts/ifcfg-eth2`](./033_part2/files/inetRouter - cat _etc_sysconfig_network-scripts_ifcfg-eth2.txt)
[details --no-link]:[лог `ip a`](./033_part2/files/inetRouter - _sbin_ip a.txt)
[details --no-link]:[лог `ip r`](./033_part2/files/inetRouter - _sbin_ip r.txt)
[details --no-link]:[лог `ping -s 64 -c 4 10.1.1.2`](./033_part2/files/inetRouter - ping -s 64 -c 4 10.1.1.2.txt)

Для centralRouter:

[details --no-link]:[лог `cat /etc/modprobe.conf.`](./033_part2/files/centralRouter - cat _etc_modprobe.conf.txt)
[details --no-link]:[лог `cat /etc/sysconfig/network-scripts/ifcfg-bond0`](./033_part2/files/centralRouter - cat _etc_sysconfig_network-scripts_ifcfg-bond0.txt)
[details --no-link]:[лог `cat /etc/sysconfig/network-scripts/ifcfg-eth1`](./033_part2/files/centralRouter - cat _etc_sysconfig_network-scripts_ifcfg-eth1.txt)
[details --no-link]:[лог `cat /etc/sysconfig/network-scripts/ifcfg-eth2`](./033_part2/files/centralRouter - cat _etc_sysconfig_network-scripts_ifcfg-eth2.txt)
[details --no-link]:[лог `ip a`](./033_part2/files/centralRouter - _sbin_ip a.txt)
[details --no-link]:[лог `ip r`](./033_part2/files/centralRouter - _sbin_ip r.txt)
[details --no-link]:[лог `ping -s 64 -c 4 10.1.1.1`](./033_part2/files/centralRouter - ping -s 64 -c 4 10.1.1.1.txt)

## Вывод
Интересно, почему PING с потерями

[details --no-link]:[лог `ping -s 64 -c 4 10.1.1.1`](./033_part2/files/centralRouter - ping -s 64 -c 4 10.1.1.1.txt)